# ANIMA ‚Äî MEC√ÇNICAS DE RETEN√á√ÉO E TRAVESSIA

**Para:** Claude Code (implementar sobre o ANIMA existente)  
**Regra:** N√ÉO alterar identidade visual, cores, tipografia, layout ou componentes existentes  
**Objectivo:** Transformar chats soltos numa jornada com in√≠cio, meio e fim + loops de reten√ß√£o  
**Data:** 19 Fevereiro 2026

-----

## O QUE FALTA (e este documento resolve)

O ANIMA j√° funciona como chat com 4 mirrors. Mas falta:

1. Sensa√ß√£o de PERCURSO (n√£o chats aleat√≥rios)
1. Motivo para VOLTAR amanh√£
1. Captura de VALOR pessoal (insights do user)
1. Progress√£o VIS√çVEL que motiva
1. RITUAIS que criam h√°bito e presen√ßa
1. CONEX√ÉO emocional com a plataforma

-----

## 1. SESS√ïES ESTRUTURADAS

### Conceito

Cada Mirror tem **7 sess√µes tem√°ticas** com t√≠tulo, subt√≠tulo e prompt dedicado.  
O user n√£o ‚Äúabre um chat‚Äù ‚Äî **entra numa sess√£o** com prop√≥sito claro.  
Sess√µes desbloqueiam sequencialmente (sess√£o 4 s√≥ ap√≥s completar 3).

### Database

```sql
-- Sess√µes definidas por mirror
CREATE TABLE IF NOT EXISTS mirror_sessions (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  mirror_slug TEXT NOT NULL,
  session_number INTEGER NOT NULL CHECK (session_number BETWEEN 1 AND 7),
  title_pt TEXT NOT NULL,
  title_en TEXT NOT NULL,
  title_es TEXT NOT NULL,
  title_fr TEXT NOT NULL,
  subtitle_pt TEXT NOT NULL,
  subtitle_en TEXT NOT NULL,
  subtitle_es TEXT NOT NULL,
  subtitle_fr TEXT NOT NULL,
  session_prompt TEXT NOT NULL,
  estimated_minutes INTEGER DEFAULT 15,
  unlock_after INTEGER DEFAULT NULL,
  UNIQUE(mirror_slug, session_number)
);

-- Progresso do user por sess√£o
CREATE TABLE IF NOT EXISTS user_sessions (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  mirror_slug TEXT NOT NULL,
  session_number INTEGER NOT NULL,
  status TEXT DEFAULT 'locked' CHECK (status IN ('locked', 'available', 'in_progress', 'completed')),
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  conversation_id UUID,
  exit_insight TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, mirror_slug, session_number)
);

-- RLS
ALTER TABLE user_sessions ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users see own sessions" ON user_sessions
  FOR ALL USING (auth.uid() = user_id);
```

### Seed: SOMA (7 sess√µes)

```sql
INSERT INTO mirror_sessions (mirror_slug, session_number, title_pt, title_en, title_es, title_fr, subtitle_pt, subtitle_en, subtitle_es, subtitle_fr, session_prompt, estimated_minutes, unlock_after) VALUES

('soma', 1,
 'O corpo que habitas', 'The body you inhabit', 'El cuerpo que habitas', 'Le corps que tu habites',
 'Reconex√£o com sensa√ß√µes f√≠sicas', 'Reconnecting with physical sensations', 'Reconexi√≥n con sensaciones f√≠sicas', 'Reconnexion avec les sensations physiques',
 'SESS√ÉO 1: O foco √© ajudar a pessoa a SENTIR o corpo agora. Perguntas: como est√° o corpo neste momento? Onde h√° tens√£o? Onde h√° conforto? Quando foi a √∫ltima vez que parou para sentir? N√ÉO dar conselhos ‚Äî guiar aten√ß√£o para o corpo.',
 15, NULL),

('soma', 2,
 'Fome de qu√™?', 'Hungry for what?', 'Hambre de qu√©?', 'Faim de quoi?',
 'Quando comes, o que alimentas realmente?', 'When you eat, what do you really feed?', 'Cuando comes, qu√© alimentas realmente?', 'Quand tu manges, que nourris-tu vraiment?',
 'SESS√ÉO 2: Nutri√ß√£o emocional vs f√≠sica. Explorar: o que sentias ANTES de comer? O que tentavas alimentar? Quando foi a √∫ltima vez que comeste com presen√ßa total? Conectar padr√µes alimentares com estados emocionais.',
 12, 1),

('soma', 3,
 'Onde mora a tens√£o', 'Where tension lives', 'Donde vive la tensi√≥n', 'O√π vit la tension',
 'O mapa emocional do teu corpo', 'The emotional map of your body', 'El mapa emocional de tu cuerpo', 'La carte √©motionnelle de ton corps',
 'SESS√ÉO 3: Mapeamento corporal de emo√ß√µes. Guiar: ONDE no corpo sentes stress? Alegria? Medo? Raiva? Construir mapa pessoal. O corpo guarda tudo ‚Äî onde guardas o qu√™?',
 15, 2),

('soma', 4,
 'O peso invis√≠vel', 'The invisible weight', 'El peso invisible', 'Le poids invisible',
 'Cren√ßas sobre o corpo que carregas sem saber', 'Body beliefs you carry unknowingly', 'Creencias corporales que cargas sin saber', 'Croyances corporelles port√©es sans le savoir',
 'SESS√ÉO 4: Cren√ßas limitantes sobre o corpo. De onde v√™m? Quem disse que devias ser diferente? Que voz interna fala ao espelho? Separar voz pr√≥pria das vozes herdadas.',
 15, 3),

('soma', 5,
 'Rituais de cuidado', 'Rituals of care', 'Rituales de cuidado', 'Rituels de soin',
 'Pr√°ticas simples de presen√ßa corporal', 'Simple practices of body presence', 'Pr√°cticas simples de presencia corporal', 'Pratiques simples de pr√©sence corporelle',
 'SESS√ÉO 5: Sess√£o pr√°tica. Definir 1-2 rituais simples de conex√£o corporal. N√£o exerc√≠cios ‚Äî rituais. Ex: 30s de respira√ß√£o ao acordar, uma refei√ß√£o em sil√™ncio. O que √© poss√≠vel e sustent√°vel para esta pessoa?',
 12, 4),

('soma', 6,
 'O espelho interior', 'The inner mirror', 'El espejo interior', 'Le miroir int√©rieur',
 'Como te v√™s vs. como √©s', 'How you see yourself vs. who you are', 'C√≥mo te ves vs. c√≥mo eres', 'Comment tu te vois vs. qui tu es',
 'SESS√ÉO 6: Auto-imagem corporal. Diferen√ßa entre corpo imaginado e corpo real. Quando te olhas, o que v√™s primeiro? O que evitas ver? Se o teu corpo falasse, o que diria sobre como o tratas?',
 15, 5),

('soma', 7,
 'Integra√ß√£o som√°tica', 'Somatic integration', 'Integraci√≥n som√°tica', 'Int√©gration somatique',
 'Tudo o que o corpo te ensinou', 'Everything the body taught you', 'Todo lo que el cuerpo te ense√±√≥', 'Tout ce que le corps t''a appris',
 'SESS√ÉO 7 (FINAL): Revisitar as 6 sess√µes. O que mudou? Que padr√µes foram identificados? Que rituais funcionaram? Preparar transi√ß√£o para SEREN. O corpo agora tem voz ‚Äî a mente quer ouvir.',
 20, 6);
```

### Seed: SEREN (7 sess√µes)

```sql
INSERT INTO mirror_sessions (mirror_slug, session_number, title_pt, title_en, title_es, title_fr, subtitle_pt, subtitle_en, subtitle_es, subtitle_fr, session_prompt, estimated_minutes, unlock_after) VALUES

('seren', 1,
 'O ru√≠do que n√£o p√°ra', 'The noise that won''t stop', 'El ruido que no para', 'Le bruit qui ne s''arr√™te pas',
 'O que a mente faz quando n√£o a observas', 'What the mind does when unobserved', 'Lo que la mente hace sin ser observada', 'Ce que l''esprit fait sans surveillance',
 'SESS√ÉO 1: Explorar di√°logo interno. Quantos pensamentos sem parar? Que temas repetem? A mente protege de qu√™? Se referir insights de SOMA quando relevante. N√ÉO julgar pensamentos ‚Äî observar.',
 15, NULL),

('seren', 2,
 'A ansiedade tem um nome', 'Anxiety has a name', 'La ansiedad tiene nombre', 'L''anxi√©t√© a un nom',
 'Dar forma ao que parece sem forma', 'Giving shape to what feels shapeless', 'Dar forma a lo informe', 'Donner forme √† l''informe',
 'SESS√ÉO 2: Personificar a ansiedade. Se fosse uma pessoa, como seria? Que idade tem? O que quer? Quando aparece? T√©cnica de externaliza√ß√£o para criar dist√¢ncia saud√°vel do estado ansioso.',
 12, 1),

('seren', 3,
 'Gatilhos e rea√ß√µes', 'Triggers and reactions', 'Disparadores y reacciones', 'D√©clencheurs et r√©actions',
 'O espa√ßo entre o que acontece e o que fazes', 'The space between what happens and what you do', 'El espacio entre lo que pasa y lo que haces', 'L''espace entre ce qui arrive et ce que tu fais',
 'SESS√ÉO 3: Mapear ciclos reactivos. Que situa√ß√µes disparam reac√ß√µes autom√°ticas? O que acontece no corpo (link SOMA) antes da reac√ß√£o? Existe espa√ßo entre est√≠mulo e resposta? Quanto espa√ßo?',
 15, 2),

('seren', 4,
 'O que evitas sentir', 'What you avoid feeling', 'Lo que evitas sentir', 'Ce que tu √©vites de ressentir',
 'As emo√ß√µes que empurras para baixo', 'The emotions you push down', 'Las emociones que empujas hacia abajo', 'Les √©motions que tu repousses',
 'SESS√ÉO 4: Explorar evitamento emocional. Que emo√ß√µes s√£o "proibidas"? Tristeza? Raiva? Vulnerabilidade? Quem ensinou que n√£o podias sentir isso? O que acontece quando tentas N√ÉO sentir?',
 15, 3),

('seren', 5,
 'O porto seguro', 'The safe harbour', 'El puerto seguro', 'Le port s√ªr',
 'Construir regula√ß√£o emocional pr√≥pria', 'Building your own emotional regulation', 'Construir regulaci√≥n emocional propia', 'Construire sa propre r√©gulation √©motionnelle',
 'SESS√ÉO 5: Pr√°tica de autorregula√ß√£o. N√£o suprimir emo√ß√µes ‚Äî navegar. Que estrat√©gias saud√°veis j√° usas sem perceber? Quais podes fortalecer? Criar toolkit emocional pessoal.',
 12, 4),

('seren', 6,
 'Rela√ß√µes como espelhos', 'Relationships as mirrors', 'Relaciones como espejos', 'Relations comme miroirs',
 'O que os outros revelam sobre ti', 'What others reveal about you', 'Lo que otros revelan sobre ti', 'Ce que les autres r√©v√®lent de toi',
 'SESS√ÉO 6: Padr√µes relacionais. Que tipo de pessoas atrais? Que papel assumes nos conflictos? O que te irrita nos outros revela o qu√™ sobre ti? Rela√ß√µes como espelhos do mundo interno.',
 15, 5),

('seren', 7,
 'Mente em paz', 'Mind at peace', 'Mente en paz', 'Esprit en paix',
 'S√≠ntese emocional e transi√ß√£o', 'Emotional synthesis and transition', 'S√≠ntesis emocional y transici√≥n', 'Synth√®se √©motionnelle et transition',
 'SESS√ÉO 7 (FINAL): Revisitar jornada SEREN. Gatilhos identificados, emo√ß√µes nomeadas, estrat√©gias criadas. Link com SOMA. Preparar LUMA: a mente acalmou ‚Äî agora podes ver mais longe.',
 20, 6);
```

### Seed: LUMA (7 sess√µes)

```sql
INSERT INTO mirror_sessions (mirror_slug, session_number, title_pt, title_en, title_es, title_fr, subtitle_pt, subtitle_en, subtitle_es, subtitle_fr, session_prompt, estimated_minutes, unlock_after) VALUES

('luma', 1,
 'As certezas que nunca questionaste', 'Certainties never questioned', 'Las certezas nunca cuestionadas', 'Les certitudes jamais questionn√©es',
 'Onde come√ßa aquilo que acreditas ser verdade', 'Where what you believe to be true begins', 'Donde empieza lo que crees verdad', 'O√π commence ce que tu crois vrai',
 'SESS√ÉO 1: Identificar cren√ßas fundamentais sobre si. "Eu sou..." o qu√™? De onde vem essa certeza? Algu√©m disse ou tu decidiste? Come√ßar a questionar sem destruir.',
 15, NULL),

('luma', 2,
 'A hist√≥ria que contas', 'The story you tell', 'La historia que cuentas', 'L''histoire que tu racontes',
 'A narrativa pessoal que constr√≥is todos os dias', 'The personal narrative you build every day', 'La narrativa personal que construyes cada d√≠a', 'Le r√©cit personnel que tu construis chaque jour',
 'SESS√ÉO 2: Explorar a narrativa autobiogr√°fica. Que hist√≥ria contas sobre ti? √â a mesma que contavas h√° 10 anos? Quem serias sem essa hist√≥ria? A hist√≥ria protege ou limita?',
 15, 1),

('luma', 3,
 'Medos disfar√ßados', 'Fears in disguise', 'Miedos disfrazados', 'Peurs d√©guis√©es',
 'O que parece raz√£o mas √© medo', 'What looks like reason but is fear', 'Lo que parece raz√≥n pero es miedo', 'Ce qui semble raison mais est peur',
 'SESS√ÉO 3: Distinguir decis√µes racionais de decis√µes baseadas em medo. "N√£o fa√ßo X porque √© prudente" ou porque tenho medo? Que decis√µes importantes adias por "boas raz√µes" que s√£o na verdade medo?',
 15, 2),

('luma', 4,
 'Expans√£o e contra√ß√£o', 'Expansion and contraction', 'Expansi√≥n y contracci√≥n', 'Expansion et contraction',
 'Sentir a diferen√ßa entre crescer e encolher', 'Feeling the difference between growing and shrinking', 'Sentir la diferencia entre crecer y encogerse', 'Sentir la diff√©rence entre grandir et r√©tr√©cir',
 'SESS√ÉO 4: Usar sensa√ß√µes de expans√£o/contra√ß√£o como b√∫ssola. Que pensamentos expandem? Que pensamentos contraem? Que escolhas te fazem sentir maior? Menor? Referir mapa corporal de SOMA.',
 15, 3),

('luma', 5,
 'O eu que ningu√©m v√™', 'The self nobody sees', 'El yo que nadie ve', 'Le moi que personne ne voit',
 'Partes de ti que escondes do mundo', 'Parts of you hidden from the world', 'Partes de ti que escondes del mundo', 'Parts de toi cach√©es du monde',
 'SESS√ÉO 5: Shadow work leve. Que partes de ti escondes? Porqu√™? Que qualidades admiras nos outros que n√£o te permites ter? O que aconteceria se mostrasses essa parte?',
 15, 4),

('luma', 6,
 'Al√©m da identidade', 'Beyond identity', 'M√°s all√° de la identidad', 'Au-del√† de l''identit√©',
 'Quem √©s quando largas todos os r√≥tulos', 'Who are you when all labels drop', 'Qui√©n eres cuando sueltas todas las etiquetas', 'Qui es-tu quand toutes les √©tiquettes tombent',
 'SESS√ÉO 6: Explorar identidade al√©m de pap√©is (m√£e, profissional, parceiro). Quem √©s quando tiras tudo? O que resta? Medo ou liberdade? Presen√ßa pura como funda√ß√£o.',
 15, 5),

('luma', 7,
 'A luz que j√° √©s', 'The light you already are', 'La luz que ya eres', 'La lumi√®re que tu es d√©j√†',
 'S√≠ntese da expans√£o de consci√™ncia', 'Synthesis of consciousness expansion', 'S√≠ntesis de la expansi√≥n de consciencia', 'Synth√®se de l''expansion de conscience',
 'SESS√ÉO 7 (FINAL): Integrar LUMA. Cren√ßas questionadas, medos nomeados, identidade expandida. Link SOMA+SEREN. Preparar ECHO: agora que v√™s mais ‚Äî que padr√µes atravessam TUDO?',
 20, 6);
```

### Seed: ECHO (7 sess√µes)

```sql
INSERT INTO mirror_sessions (mirror_slug, session_number, title_pt, title_en, title_es, title_fr, subtitle_pt, subtitle_en, subtitle_es, subtitle_fr, session_prompt, estimated_minutes, unlock_after) VALUES

('echo', 1,
 'Os ciclos que se repetem', 'Cycles that repeat', 'Los ciclos que se repiten', 'Les cycles qui se r√©p√®tent',
 'Padr√µes que atravessam toda a tua vida', 'Patterns that run through your entire life', 'Patrones que atraviesan toda tu vida', 'Sch√©mas qui traversent toute ta vie',
 'SESS√ÉO 1: ECHO tem acesso a TODOS os insights de SOMA, SEREN e LUMA. Come√ßar por mostrar meta-padr√µes. Que temas apareceram em TODOS os mirrors? Que ciclo se repete? Come√ßar a integrar.',
 15, NULL),

('echo', 2,
 'A heran√ßa invis√≠vel', 'The invisible inheritance', 'La herencia invisible', 'L''h√©ritage invisible',
 'O que herdaste sem saber', 'What you inherited unknowingly', 'Lo que heredaste sin saber', 'Ce que tu as h√©rit√© sans le savoir',
 'SESS√ÉO 2: Padr√µes intergeracionais. Que comportamentos dos teus pais reconheces em ti? Que medos (LUMA) ecoam de gera√ß√µes anteriores? O que te foi passado sem palavras?',
 15, 1),

('echo', 3,
 'O fio condutor', 'The common thread', 'El hilo conductor', 'Le fil conducteur',
 'A liga√ß√£o entre corpo, mente e consci√™ncia', 'The link between body, mind and consciousness', 'La conexi√≥n entre cuerpo, mente y consciencia', 'Le lien entre corps, esprit et conscience',
 'SESS√ÉO 3: S√≠ntese cross-mirror expl√≠cita. O padr√£o corporal (SOMA) + o padr√£o emocional (SEREN) + a cren√ßa (LUMA) = o ECO. Mostrar como o mesmo tema apareceu em 3 formas diferentes.',
 15, 2),

('echo', 4,
 'Escolhas autom√°ticas', 'Automatic choices', 'Elecciones autom√°ticas', 'Choix automatiques',
 'Decis√µes que tomas sem decidir', 'Decisions you make without deciding', 'Decisiones que tomas sin decidir', 'D√©cisions prises sans d√©cider',
 'SESS√ÉO 4: Loops comportamentais. Que escolhas repetes no piloto autom√°tico? Nas rela√ß√µes, no trabalho, no corpo. Agora que v√™s o padr√£o ‚Äî o que fazes com essa informa√ß√£o?',
 15, 3),

('echo', 5,
 'Quebrar o ciclo', 'Breaking the cycle', 'Romper el ciclo', 'Briser le cycle',
 'Escolher diferente com consci√™ncia', 'Choosing differently with awareness', 'Elegir diferente con consciencia', 'Choisir diff√©remment avec conscience',
 'SESS√ÉO 5: Da consci√™ncia √† ac√ß√£o. N√£o basta ver ‚Äî √© preciso escolher. Que padr√£o queres interromper primeiro? Qual √© o primeiro passo REAL? N√£o perfeito ‚Äî poss√≠vel.',
 15, 4),

('echo', 6,
 'A nova narrativa', 'The new narrative', 'La nueva narrativa', 'Le nouveau r√©cit',
 'Reescrever a hist√≥ria com o que aprendeste', 'Rewriting the story with what you learned', 'Reescribir la historia con lo aprendido', 'R√©√©crire l''histoire avec ce que tu as appris',
 'SESS√ÉO 6: Reconstru√ß√£o narrativa. Se LUMA questionou a hist√≥ria antiga ‚Äî ECHO ajuda a escrever a nova. N√£o uma fantasia. Uma narrativa baseada em verdade, consci√™ncia e escolha.',
 15, 5),

('echo', 7,
 'O sil√™ncio que integra', 'The silence that integrates', 'El silencio que integra', 'Le silence qui int√®gre',
 'Encerramento da jornada completa', 'Closing the complete journey', 'Cierre del viaje completo', 'Cl√¥ture du voyage complet',
 'SESS√ÉO 7 (FINAL DE TUDO): Encerramento da travessia. Revisitar TODA a jornada: SOMA‚ÜíSEREN‚ÜíLUMA‚ÜíECHO. Que pessoa come√ßou? Que pessoa est√° aqui agora? N√£o termina ‚Äî transforma. A jornada pode ser repetida com novos olhos.',
 20, 6);
```

### L√≥gica de desbloqueio

```typescript
// Quando user completa sess√£o N, desbloqueia N+1
async function completeSession(userId: string, mirrorSlug: string, sessionNumber: number) {
  const now = new Date().toISOString()
  
  // Marcar sess√£o actual como completa
  await supabase
    .from('user_sessions')
    .update({ status: 'completed', completed_at: now })
    .eq('user_id', userId)
    .eq('mirror_slug', mirrorSlug)
    .eq('session_number', sessionNumber)

  // Desbloquear pr√≥xima sess√£o
  const nextSession = sessionNumber + 1
  if (nextSession <= 7) {
    await supabase
      .from('user_sessions')
      .update({ status: 'available' })
      .eq('user_id', userId)
      .eq('mirror_slug', mirrorSlug)
      .eq('session_number', nextSession)
  }

  // Se completou sess√£o 7, desbloquear pr√≥ximo mirror
  if (sessionNumber === 7) {
    const mirrorOrder = ['soma', 'seren', 'luma', 'echo']
    const currentIndex = mirrorOrder.indexOf(mirrorSlug)
    if (currentIndex < 3) {
      const nextMirror = mirrorOrder[currentIndex + 1]
      await supabase
        .from('user_sessions')
        .update({ status: 'available' })
        .eq('user_id', userId)
        .eq('mirror_slug', nextMirror)
        .eq('session_number', 1)
    }
  }
  
  // Verificar milestones
  await checkMilestones(userId, mirrorSlug, sessionNumber)
}

// Inicializar sess√µes quando user cria conta
async function initUserSessions(userId: string) {
  const sessions = []
  const mirrors = ['soma', 'seren', 'luma', 'echo']
  
  for (const mirror of mirrors) {
    for (let i = 1; i <= 7; i++) {
      sessions.push({
        user_id: userId,
        mirror_slug: mirror,
        session_number: i,
        status: mirror === 'soma' && i === 1 ? 'available' : 'locked'
      })
    }
  }
  
  await supabase.from('user_sessions').insert(sessions)
}
```

### Integra√ß√£o com chat existente

```typescript
// Quando user inicia sess√£o, injectar prompt da sess√£o no system prompt
async function getSessionSystemPrompt(mirrorSlug: string, sessionNumber: number, basePrompt: string) {
  const { data: session } = await supabase
    .from('mirror_sessions')
    .select('session_prompt')
    .eq('mirror_slug', mirrorSlug)
    .eq('session_number', sessionNumber)
    .single()
  
  // Combinar: base prompt do mirror + prompt espec√≠fico da sess√£o
  return `${basePrompt}\n\n--- SESS√ÉO ACTUAL ---\n${session.session_prompt}`
}
```

### UI: Lista de sess√µes (dentro do mirror existente)

Onde agora aparece directamente o chat, mostrar ANTES a lista de sess√µes:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üå± SOMA ‚Äî O corpo sabe       ‚îÇ
‚îÇ Fase 1: Funda√ß√£o             ‚îÇ
‚îÇ 3 de 7 sess√µes completas     ‚îÇ
‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 43%         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚úÖ 1. O corpo que habitas    ‚îÇ
‚îÇ ‚úÖ 2. Fome de qu√™?           ‚îÇ
‚îÇ ‚úÖ 3. Onde mora a tens√£o     ‚îÇ
‚îÇ ‚ñ∂  4. O peso invis√≠vel  ~15m‚îÇ ‚Üê sess√£o actual
‚îÇ üîí 5. Rituais de cuidado    ‚îÇ
‚îÇ üîí 6. O espelho interior    ‚îÇ
‚îÇ üîí 7. Integra√ß√£o som√°tica   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

-----

## 2. RITUAL DE ENTRADA (pr√©-sess√£o)

### Conceito

Antes de abrir o chat, aparecer tela de transi√ß√£o com:

- Pergunta de presen√ßa (‚ÄúComo est√° o teu corpo agora?‚Äù)
- Op√ß√£o de respira√ß√£o guiada (3 ciclos)
- Bot√£o ‚ÄúEstou presente‚Äù para entrar
- Bot√£o ‚ÄúSaltar‚Äù para quem tem pressa

### Implementa√ß√£o

```typescript
// Componente que aparece ANTES do chat abrir
// Usar os mesmos estilos/cores do ANIMA existente

interface EntryRitualProps {
  mirrorSlug: string
  sessionNumber: number
  onEnter: () => void  // abre o chat
  onSkip: () => void   // pula directo para chat
}

// Conte√∫do por mirror (usar nas tradu√ß√µes existentes)
const RITUAL_CONTENT = {
  soma: {
    prompt_pt: "Coloca uma m√£o no peito. Sente o teu corpo presente.",
    prompt_en: "Place a hand on your chest. Feel your body present.",
    prompt_es: "Pon una mano en el pecho. Siente tu cuerpo presente.",
    prompt_fr: "Pose une main sur ta poitrine. Sens ton corps pr√©sent.",
  },
  seren: {
    prompt_pt: "Fecha os olhos por um momento. O que sentes agora?",
    prompt_en: "Close your eyes for a moment. What do you feel now?",
    prompt_es: "Cierra los ojos un momento. Qu√© sientes ahora?",
    prompt_fr: "Ferme les yeux un instant. Que ressens-tu maintenant?",
  },
  luma: {
    prompt_pt: "Respira. Abre espa√ßo para o que vier.",
    prompt_en: "Breathe. Make space for whatever comes.",
    prompt_es: "Respira. Abre espacio para lo que venga.",
    prompt_fr: "Respire. Ouvre l'espace pour ce qui viendra.",
  },
  echo: {
    prompt_pt: "Recorda o caminho at√© aqui. Est√°s pronta.",
    prompt_en: "Remember the path here. You are ready.",
    prompt_es: "Recuerda el camino hasta aqu√≠. Est√°s lista.",
    prompt_fr: "Souviens-toi du chemin. Tu es pr√™te.",
  },
}
```

**Regra:** O ritual usa exactamente os mesmos componentes visuais do ANIMA. N√£o criar novo design.

-----

## 3. RITUAL DE SA√çDA (p√≥s-sess√£o)

### Conceito

Quando o user fecha/termina uma conversa, aparecer:

- ‚ÄúO que levas desta conversa?‚Äù
- Campo de texto para escrever 1-2 frases
- Bot√£o ‚ÄúGuardar insight‚Äù ‚Üí salva em user_sessions.exit_insight
- Bot√£o ‚ÄúSaltar‚Äù para quem n√£o quer

### Implementa√ß√£o

```typescript
// Detectar fim de sess√£o:
// Op√ß√£o A: Bot√£o "Terminar sess√£o" no chat
// Op√ß√£o B: Ap√≥s X mensagens (ex: 10+), sugerir encerramento
// Op√ß√£o C: User fecha/navega para fora

// Guardar insight
async function saveExitInsight(userId: string, mirrorSlug: string, sessionNumber: number, insight: string) {
  await supabase
    .from('user_sessions')
    .update({ exit_insight: insight })
    .eq('user_id', userId)
    .eq('mirror_slug', mirrorSlug)
    .eq('session_number', sessionNumber)
  
  // Tamb√©m guardar na tabela de insights para o dashboard
  await supabase
    .from('user_insights')
    .insert({
      user_id: userId,
      mirror_slug: mirrorSlug,
      session_number: sessionNumber,
      text: insight,
      source: 'exit_ritual'
    })
}
```

### Tabela: user_insights

```sql
CREATE TABLE IF NOT EXISTS user_insights (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  mirror_slug TEXT NOT NULL,
  session_number INTEGER,
  text TEXT NOT NULL,
  source TEXT DEFAULT 'exit_ritual' CHECK (source IN ('exit_ritual', 'ai_detected', 'manual')),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE user_insights ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users see own insights" ON user_insights
  FOR ALL USING (auth.uid() = user_id);
```

-----

## 4. STREAK SYSTEM

### Conceito

Contador de dias consecutivos de pr√°tica. Simples, sem press√£o.
Mostra no dashboard: ‚Äú5 dias seguidos de pr√°tica‚Äù.

### Database

```sql
CREATE TABLE IF NOT EXISTS user_streaks (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE,
  current_streak INTEGER DEFAULT 0,
  longest_streak INTEGER DEFAULT 0,
  last_session_date DATE,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

ALTER TABLE user_streaks ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users see own streaks" ON user_streaks
  FOR ALL USING (auth.uid() = user_id);
```

### L√≥gica

```typescript
async function updateStreak(userId: string) {
  const today = new Date().toISOString().split('T')[0]
  
  const { data: streak } = await supabase
    .from('user_streaks')
    .select('*')
    .eq('user_id', userId)
    .single()
  
  if (!streak) {
    await supabase.from('user_streaks').insert({
      user_id: userId, current_streak: 1, longest_streak: 1, last_session_date: today
    })
    return
  }
  
  if (streak.last_session_date === today) return // j√° contou hoje
  
  const yesterday = new Date()
  yesterday.setDate(yesterday.getDate() - 1)
  const yesterdayStr = yesterday.toISOString().split('T')[0]
  
  const isConsecutive = streak.last_session_date === yesterdayStr
  const newStreak = isConsecutive ? streak.current_streak + 1 : 1
  const newLongest = Math.max(newStreak, streak.longest_streak)
  
  await supabase
    .from('user_streaks')
    .update({
      current_streak: newStreak,
      longest_streak: newLongest,
      last_session_date: today,
      updated_at: new Date().toISOString()
    })
    .eq('user_id', userId)
}
```

-----

## 5. MILESTONES (marcos da jornada)

### Conceito

Marcos contemplativos que aparecem ao atingir momentos-chave.
N√£o confetti ‚Äî uma mensagem significativa e um √≠cone do mirror.

### Database

```sql
CREATE TABLE IF NOT EXISTS milestones (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  trigger_type TEXT NOT NULL,
  trigger_value TEXT NOT NULL, -- ex: 'soma_session_3', 'streak_7', 'all_soma_complete'
  title_pt TEXT NOT NULL,
  title_en TEXT NOT NULL,
  title_es TEXT NOT NULL,
  title_fr TEXT NOT NULL,
  description_pt TEXT NOT NULL,
  description_en TEXT NOT NULL,
  description_es TEXT NOT NULL,
  description_fr TEXT NOT NULL,
  mirror_slug TEXT, -- NULL se for geral
  UNIQUE(trigger_type, trigger_value)
);

CREATE TABLE IF NOT EXISTS user_milestones (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  milestone_id UUID NOT NULL REFERENCES milestones(id),
  unlocked_at TIMESTAMPTZ DEFAULT NOW(),
  seen BOOLEAN DEFAULT FALSE,
  UNIQUE(user_id, milestone_id)
);

ALTER TABLE user_milestones ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users see own milestones" ON user_milestones
  FOR ALL USING (auth.uid() = user_id);
```

### Seed milestones

```sql
INSERT INTO milestones (trigger_type, trigger_value, title_pt, title_en, title_es, title_fr, description_pt, description_en, description_es, description_fr, mirror_slug) VALUES

-- SOMA milestones
('session_complete', 'soma_1', 'Primeiro passo', 'First step', 'Primer paso', 'Premier pas',
 'Come√ßaste a ouvir o corpo. Isso muda tudo.', 'You started listening to the body. That changes everything.', 'Empezaste a escuchar el cuerpo. Eso lo cambia todo.', 'Tu as commenc√© √† √©couter le corps. √áa change tout.',
 'soma'),

('session_complete', 'soma_3', 'Corpo mapeado', 'Body mapped', 'Cuerpo mapeado', 'Corps cartographi√©',
 'Agora sabes onde moras. O mapa emocional do teu corpo tem forma.', 'Now you know where you live. Your body emotional map has shape.', 'Ahora sabes d√≥nde vives. El mapa emocional tiene forma.', 'Maintenant tu sais o√π tu habites. La carte √©motionnelle a une forme.',
 'soma'),

('phase_complete', 'soma', 'Corpo desperto', 'Body awakened', 'Cuerpo despierto', 'Corps √©veill√©',
 'Completaste a funda√ß√£o. O corpo tem voz ‚Äî e tu aprendeste a ouvir.', 'Foundation complete. The body has a voice ‚Äî and you learned to listen.', 'Fundaci√≥n completa. El cuerpo tiene voz ‚Äî y aprendiste a escuchar.', 'Fondation compl√®te. Le corps a une voix ‚Äî et tu as appris √† √©couter.',
 'soma'),

-- SEREN milestones
('phase_complete', 'seren', 'Mente clara', 'Clear mind', 'Mente clara', 'Esprit clair',
 'A ansiedade tem nome. Os gatilhos s√£o vis√≠veis. A mente acalmou.', 'Anxiety has a name. Triggers are visible. The mind calmed.', 'La ansiedad tiene nombre. Los disparadores son visibles.', 'L''anxi√©t√© a un nom. Les d√©clencheurs sont visibles.',
 'seren'),

-- LUMA milestones
('phase_complete', 'luma', 'Horizonte aberto', 'Open horizon', 'Horizonte abierto', 'Horizon ouvert',
 'Cren√ßas questionadas. Medos nomeados. V√™s mais longe agora.', 'Beliefs questioned. Fears named. You see further now.', 'Creencias cuestionadas. Miedos nombrados. Ves m√°s lejos.', 'Croyances questionn√©es. Peurs nomm√©es. Tu vois plus loin.',
 'luma'),

-- ECHO milestones
('phase_complete', 'echo', 'Travessia completa', 'Journey complete', 'Traves√≠a completa', 'Travers√©e compl√®te',
 'Fizeste o caminho inteiro. N√£o o mesmo ‚Äî um novo. E podes faz√™-lo de novo, com novos olhos.', 'You walked the entire path. Not the same ‚Äî a new one. And you can do it again, with new eyes.', 'Recorriste el camino entero. No el mismo ‚Äî uno nuevo.', 'Tu as parcouru tout le chemin. Pas le m√™me ‚Äî un nouveau.',
 'echo'),

-- Streak milestones
('streak', '7', '7 dias de presen√ßa', '7 days of presence', '7 d√≠as de presencia', '7 jours de pr√©sence',
 'Uma semana inteira a aparecer. Isso √© compromisso.', 'A whole week showing up. That is commitment.', 'Una semana entera apareciendo. Eso es compromiso.', 'Une semaine enti√®re √† √™tre pr√©sent. C''est de l''engagement.',
 NULL),

('streak', '30', '30 dias de travessia', '30 days of journey', '30 d√≠as de traves√≠a', '30 jours de travers√©e',
 'Um m√™s de presen√ßa consistente. N√£o √© disciplina ‚Äî √© transforma√ß√£o.', 'A month of consistent presence. Not discipline ‚Äî transformation.', 'Un mes de presencia consistente. No es disciplina ‚Äî es transformaci√≥n.', 'Un mois de pr√©sence constante. Pas de la discipline ‚Äî de la transformation.',
 NULL);
```

### L√≥gica de verifica√ß√£o

```typescript
async function checkMilestones(userId: string, mirrorSlug: string, sessionNumber: number) {
  // Verificar milestone de sess√£o
  const sessionTrigger = `${mirrorSlug}_${sessionNumber}`
  await tryUnlockMilestone(userId, 'session_complete', sessionTrigger)
  
  // Verificar milestone de fase completa
  if (sessionNumber === 7) {
    await tryUnlockMilestone(userId, 'phase_complete', mirrorSlug)
  }
}

async function checkStreakMilestones(userId: string, streakCount: number) {
  const streakTriggers = ['7', '30']
  for (const trigger of streakTriggers) {
    if (streakCount >= parseInt(trigger)) {
      await tryUnlockMilestone(userId, 'streak', trigger)
    }
  }
}

async function tryUnlockMilestone(userId: string, triggerType: string, triggerValue: string) {
  const { data: milestone } = await supabase
    .from('milestones')
    .select('id')
    .eq('trigger_type', triggerType)
    .eq('trigger_value', triggerValue)
    .single()
  
  if (!milestone) return
  
  // Inserir se n√£o existir (upsert)
  await supabase
    .from('user_milestones')
    .upsert({
      user_id: userId,
      milestone_id: milestone.id,
    }, { onConflict: 'user_id,milestone_id' })
}
```

### UI: Milestone popup

Quando user desbloqueia milestone, mostrar popup simples:

- √çcone do mirror (usar o √≠cone orb 3D que j√° existe)
- T√≠tulo do milestone
- Descri√ß√£o (1 linha)
- Bot√£o ‚ÄúContinuar‚Äù

**Usar os componentes/modal existentes do ANIMA. N√£o criar novo design.**

-----

## 6. DASHBOARD DE JORNADA

### Conceito

O ‚ÄúPainel‚Äù existente na sidebar passa a mostrar o progresso real:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ A tua travessia                       ‚îÇ
‚îÇ                                       ‚îÇ
‚îÇ ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 25%            ‚îÇ
‚îÇ Fase 1 de 4 ¬∑ Sess√£o 3 de 7          ‚îÇ
‚îÇ                                       ‚îÇ
‚îÇ üî• 5 dias seguidos                    ‚îÇ
‚îÇ üí° 3 insights capturados              ‚îÇ
‚îÇ üåÄ 2 padr√µes identificados            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ √öltimos insights                      ‚îÇ
‚îÇ                                       ‚îÇ
‚îÇ "Percebo que como quando sinto        ‚îÇ
‚îÇ  solid√£o. N√£o √© fome."                ‚îÇ
‚îÇ  ‚Äî SOMA, sess√£o 2                     ‚îÇ
‚îÇ                                       ‚îÇ
‚îÇ "A tens√£o nos ombros aparece antes    ‚îÇ
‚îÇ  de reuni√µes."                        ‚îÇ
‚îÇ  ‚Äî SOMA, sess√£o 3                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Pr√≥xima sess√£o                        ‚îÇ
‚îÇ                                       ‚îÇ
‚îÇ üå± O peso invis√≠vel                   ‚îÇ
‚îÇ Cren√ßas sobre o corpo  ¬∑ ~15min       ‚îÇ
‚îÇ [Continuar jornada ‚Üí]                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Dados necess√°rios

```typescript
async function getDashboardData(userId: string) {
  // Progresso geral
  const { data: sessions } = await supabase
    .from('user_sessions')
    .select('mirror_slug, session_number, status')
    .eq('user_id', userId)
  
  const completed = sessions.filter(s => s.status === 'completed').length
  const total = 28 // 4 mirrors √ó 7 sess√µes
  const progress = Math.round((completed / total) * 100)
  
  // Fase actual
  const currentSession = sessions
    .filter(s => s.status === 'available' || s.status === 'in_progress')
    .sort((a, b) => {
      const mirrorOrder = { soma: 0, seren: 1, luma: 2, echo: 3 }
      return mirrorOrder[a.mirror_slug] - mirrorOrder[b.mirror_slug] || a.session_number - b.session_number
    })[0]
  
  // Streak
  const { data: streak } = await supabase
    .from('user_streaks')
    .select('current_streak')
    .eq('user_id', userId)
    .single()
  
  // Insights
  const { data: insights } = await supabase
    .from('user_insights')
    .select('text, mirror_slug, session_number, created_at')
    .eq('user_id', userId)
    .order('created_at', { ascending: false })
    .limit(5)
  
  // Milestones n√£o vistos
  const { data: newMilestones } = await supabase
    .from('user_milestones')
    .select('*, milestones(*)')
    .eq('user_id', userId)
    .eq('seen', false)
  
  return { progress, completed, total, currentSession, streak, insights, newMilestones }
}
```

-----

## 7. CROSS-MIRROR CONTEXT (intelig√™ncia entre mirrors)

### Conceito

Quando user est√° no SEREN, o mirror SABE o que SOMA descobriu.
Quando chega ao ECHO, ECHO sabe TUDO.

### Implementa√ß√£o

```typescript
async function buildCrossMirrorContext(userId: string, currentMirror: string): Promise<string> {
  // Buscar insights de mirrors anteriores
  const mirrorOrder = ['soma', 'seren', 'luma', 'echo']
  const currentIndex = mirrorOrder.indexOf(currentMirror)
  const previousMirrors = mirrorOrder.slice(0, currentIndex)
  
  if (previousMirrors.length === 0) return ''
  
  const { data: insights } = await supabase
    .from('user_insights')
    .select('text, mirror_slug, session_number')
    .eq('user_id', userId)
    .in('mirror_slug', previousMirrors)
    .order('created_at', { ascending: true })
  
  if (!insights || insights.length === 0) return ''
  
  let context = '\n\n--- CONTEXTO DE MIRRORS ANTERIORES ---\n'
  context += 'A pessoa j√° percorreu fases anteriores. Insights capturados:\n\n'
  
  for (const insight of insights) {
    const mirrorName = insight.mirror_slug.toUpperCase()
    context += `[${mirrorName}, sess√£o ${insight.session_number}]: "${insight.text}"\n`
  }
  
  context += '\nUsa estes insights NATURALMENTE quando relevante. N√£o forces conex√µes. '
  context += 'Quando fizer sentido, mostra √† pessoa como o que est√° a descobrir agora '
  context += 'se conecta com o que j√° descobriu antes.\n'
  context += '--- FIM CONTEXTO ---\n'
  
  return context
}

// No chat API, antes de enviar para Claude:
const basePrompt = getMirrorBasePrompt(mirrorSlug)
const sessionPrompt = await getSessionPrompt(mirrorSlug, sessionNumber)
const crossContext = await buildCrossMirrorContext(userId, mirrorSlug)
const fullSystemPrompt = basePrompt + sessionPrompt + crossContext
```

-----

## 8. PATTERN DETECTION (detec√ß√£o de padr√µes)

### Conceito

A IA detecta temas recorrentes nas conversas e mostra ao user.

### Database

```sql
CREATE TABLE IF NOT EXISTS user_patterns (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  pattern_type TEXT NOT NULL,
  pattern_label_pt TEXT NOT NULL,
  pattern_label_en TEXT NOT NULL,
  mention_count INTEGER DEFAULT 1,
  first_seen_mirror TEXT NOT NULL,
  first_seen_session INTEGER NOT NULL,
  last_seen_at TIMESTAMPTZ DEFAULT NOW(),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, pattern_type)
);

ALTER TABLE user_patterns ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users see own patterns" ON user_patterns
  FOR ALL USING (auth.uid() = user_id);
```

### Detec√ß√£o via Claude

Em vez de keyword matching (fr√°gil), pedir ao pr√≥prio Claude que identifique padr√µes:

```typescript
// Ap√≥s cada sess√£o completa, enviar conversa para an√°lise
async function detectPatterns(userId: string, conversationMessages: Message[]) {
  const response = await anthropic.messages.create({
    model: 'claude-sonnet-4-20250514',
    max_tokens: 500,
    system: `Analisa esta conversa e identifica padr√µes comportamentais ou emocionais recorrentes.
Responde APENAS em JSON com este formato:
{
  "patterns": [
    {
      "type": "emotional_eating",
      "label_pt": "Comer emocional",
      "label_en": "Emotional eating",
      "confidence": 0.8
    }
  ]
}
Se n√£o detectares padr√µes claros, responde: {"patterns": []}
Apenas inclui padr√µes com confidence > 0.6`,
    messages: [
      {
        role: 'user',
        content: `Conversa para analisar:\n${conversationMessages.map(m => `${m.role}: ${m.content}`).join('\n')}`
      }
    ]
  })
  
  const result = JSON.parse(response.content[0].text)
  
  for (const pattern of result.patterns) {
    // Upsert: incrementar se existir, criar se n√£o
    const { data: existing } = await supabase
      .from('user_patterns')
      .select('id, mention_count')
      .eq('user_id', userId)
      .eq('pattern_type', pattern.type)
      .single()
    
    if (existing) {
      await supabase
        .from('user_patterns')
        .update({
          mention_count: existing.mention_count + 1,
          last_seen_at: new Date().toISOString()
        })
        .eq('id', existing.id)
    } else {
      await supabase
        .from('user_patterns')
        .insert({
          user_id: userId,
          pattern_type: pattern.type,
          pattern_label_pt: pattern.label_pt,
          pattern_label_en: pattern.label_en,
          first_seen_mirror: mirrorSlug,
          first_seen_session: sessionNumber
        })
    }
  }
}
```

-----

## 9. NOTIFICA√á√ïES DE RE-ENGAGEMENT

### Conceito

Nudges gentis quando o user n√£o aparece:

- **24h sem sess√£o:** Nada (normal)
- **48h:** Email suave: ‚ÄúA tua jornada espera por ti‚Äù
- **7 dias:** Email: ‚ÄúO SOMA lembra-se de ti‚Äù (com √∫ltimo insight)
- **14 dias:** Email final: ‚ÄúQuando quiseres, estamos aqui‚Äù

### Implementa√ß√£o (Supabase Edge Function + Cron)

```typescript
// supabase/functions/engagement-nudge/index.ts
// Corre diariamente via cron

import { createClient } from '@supabase/supabase-js'

Deno.serve(async () => {
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  )
  
  const now = new Date()
  const twoDaysAgo = new Date(now.getTime() - 48 * 60 * 60 * 1000).toISOString()
  const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString()
  
  // Users inactivos h√° 48h (que n√£o receberam nudge recente)
  const { data: inactive48h } = await supabase
    .from('user_streaks')
    .select('user_id, last_session_date')
    .lt('last_session_date', twoDaysAgo.split('T')[0])
    .gt('last_session_date', sevenDaysAgo.split('T')[0])
  
  // Enviar emails via Resend ou outro servi√ßo
  for (const user of inactive48h || []) {
    await sendNudgeEmail(user.user_id, '48h')
  }
  
  return new Response('OK')
})
```

-----

## 10. FLUXO COMPLETO DA TRAVESSIA

```
1. User cria conta
   ‚Üí initUserSessions() cria 28 sess√µes (todas locked excepto SOMA sess√£o 1)

2. User vai a SOMA
   ‚Üí V√™ lista de 7 sess√µes (s√≥ sess√£o 1 dispon√≠vel)

3. User clica "O corpo que habitas"
   ‚Üí Ritual de entrada aparece
   ‚Üí User clica "Estou presente" ou "Saltar"
   ‚Üí Chat abre com system prompt = base + sess√£o 1

4. User conversa (~15min)
   ‚Üí Ao fechar ou ap√≥s 10+ mensagens, op√ß√£o "Terminar sess√£o"

5. Ritual de sa√≠da
   ‚Üí "O que levas desta conversa?"
   ‚Üí User escreve insight ‚Üí salva em user_insights
   ‚Üí Sess√£o marcada como completa
   ‚Üí Sess√£o 2 desbloqueia
   ‚Üí Streak actualiza
   ‚Üí Milestone verificado ‚Üí se desbloqueou, mostra popup

6. User volta amanh√£
   ‚Üí Dashboard mostra: streak, insights, pr√≥xima sess√£o
   ‚Üí Sensa√ß√£o de continuidade, n√£o de chat aleat√≥rio

7. Ap√≥s 7 sess√µes de SOMA
   ‚Üí Milestone "Corpo Desperto" aparece
   ‚Üí SEREN sess√£o 1 desbloqueia
   ‚Üí Cross-mirror context come√ßa (SEREN sabe o que SOMA descobriu)

8. Ap√≥s 28 sess√µes (4 mirrors √ó 7)
   ‚Üí Milestone "Travessia Completa"
   ‚Üí Op√ß√£o de repetir jornada (com novos olhos)
   ‚Üí Insights export√°veis como di√°rio pessoal
```

-----

## PRIORIDADE DE IMPLEMENTA√á√ÉO

### Imediato (antes do launch):

1. ‚úÖ mirror_sessions + user_sessions (tabelas + seed)
1. ‚úÖ Lista de sess√µes por mirror (UI)
1. ‚úÖ L√≥gica de desbloqueio
1. ‚úÖ Session prompt injection no chat
1. ‚úÖ Dashboard b√°sico com progresso

### Semana 1 p√≥s-launch:

1. ‚úÖ Ritual de entrada
1. ‚úÖ Ritual de sa√≠da + captura de insights
1. ‚úÖ Streak system
1. ‚úÖ Milestones

### Semana 2-3 p√≥s-launch:

1. ‚úÖ Cross-mirror context
1. ‚úÖ Pattern detection
1. ‚úÖ Emails de re-engagement
1. ‚úÖ Export de insights como di√°rio

-----

**FIM DO DOCUMENTO**

Tudo aqui √© ADITIVO ‚Äî adiciona sobre o que existe sem mudar nada do visual ou estrutura actual do ANIMA.